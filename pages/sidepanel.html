<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tab Story</title>
  <link rel="icon" type="image/png" href="../icons/icon-48.png">

  <!-- Styles -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300;400;500;600;700" rel="stylesheet">

  <link rel="stylesheet" href="../styles/variables.css">
  <link rel="stylesheet" href="../styles/components.css">
  <link rel="stylesheet" href="../styles/animations.css">
  <link rel="stylesheet" href="../styles/sidepanel.css">
</head>
<body>

  <!-- ===== Main Side Panel View ===== -->
  <div id="main-view" class="view active">

    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <img src="../icons/logo.png" alt="Tab Story Logo" class="app-logo">
        <h1 class="app-title">Tab Story</h1>
      </div>
      <div class="header-right">
        <button class="btn-icon" id="timeline-btn" aria-label="Timeline view" title="Timeline View">
          <span class="material-symbols-outlined">schedule</span>
        </button>
        <button class="btn-icon" id="settings-btn" aria-label="Settings" title="Settings">
          <span class="material-symbols-outlined">settings</span>
        </button>
      </div>
    </header>

    <!-- Search Bar -->
    <div class="search-container">
      <div class="search-wrapper">
        <span class="material-symbols-outlined search-icon">search</span>
        <input
          type="text"
          class="search-input"
          id="search-input"
          placeholder="Search tabs, notes, or intent..."
          aria-label="Search tabs"
        >
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button class="quick-action-btn" id="new-intent-quick">
        <span class="material-symbols-outlined">auto_awesome</span>
        <span>New Intent</span>
      </button>
    </div>

    <!-- Main Content -->
    <main class="main-content custom-scrollbar">
      <div id="content-area" class="content-scroll">

        <!-- Loading State (Hidden by default) -->
        <div id="loading-state" class="loading-container hidden">
          <div class="spinner"></div>
          <p class="loading-text">Loading your tabs...</p>
        </div>

        <!-- Empty State (Hidden by default) -->
        <div id="empty-state" class="empty-state-container hidden">
          <div class="empty-icon">ðŸ“‘</div>
          <h2 class="empty-title">No Tabs Yet</h2>
          <p class="empty-description">Start browsing and organize your tabs with intents!</p>
          <button class="btn btn-primary" id="new-intent-btn">
            <span class="material-symbols-outlined">add</span>
            Create Intent
          </button>
        </div>

        <!-- Project Groups Container (dynamically populated by JavaScript) -->
        <div id="project-groups" class="project-groups"></div>

      </div>
    </main>

    <!-- Footer Stats -->
    <footer class="footer">
      <div class="stats-bar">
        <div class="stat-item">
          <span class="material-symbols-outlined">tab</span>
          <span id="total-tabs">0 tabs</span>
        </div>
        <div class="stat-item">
          <span class="material-symbols-outlined">folder</span>
          <span id="total-groups">0 groups</span>
        </div>
        <div class="stat-item">
          <span class="material-symbols-outlined">schedule</span>
          <span id="session-time">0s</span>
        </div>
        <div class="stat-item stat-item-storage" id="storage-indicator" title="Storage usage - Click settings to view details">
          <span class="material-symbols-outlined">storage</span>
          <span id="storage-usage-text">0 KB</span>
        </div>
      </div>
    </footer>

  </div>

  <!-- ===== Tab Detail View ===== -->
  <div id="detail-view" class="detail-view">
    <div class="detail-header">
      <button class="detail-back-btn" id="detail-back-btn">
        <span class="material-symbols-outlined">arrow_back</span>
        Back
      </button>
      <h2 class="detail-title" id="detail-title">Tab Details</h2>
    </div>

    <div class="detail-body custom-scrollbar" id="detail-body">
      <!-- Tab Detail Card -->
      <div class="tab-detail-card">
        <!-- Project Title Section -->
        <div class="tab-detail-header">
          <h3 class="tab-detail-title" id="detail-card-title">Tab Details</h3>
        </div>

        <!-- Card Body -->
        <div class="tab-detail-body">
          <!-- Intent Badge -->
          <div class="detail-section">
            <div class="detail-badge" id="detail-intent">General</div>
          </div>

          <!-- Description -->
          <div class="detail-section">
            <p class="detail-description" id="detail-summary">Loading tab information...</p>
          </div>

          <!-- Timestamp -->
          <div class="detail-section">
            <div class="detail-timestamp" id="detail-time">
              <span class="material-symbols-outlined">schedule</span>
              <span>Just now</span>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="tab-detail-actions">
          <button class="btn btn-primary" id="detail-summarize">
            <span class="material-symbols-outlined">auto_awesome</span>
            AI Summary
          </button>
          <button class="btn btn-outline" id="detail-restore-all">
            <span class="material-symbols-outlined">restore</span>
            Restore All Tabs
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Timeline View ===== -->
  <div id="timeline-view" class="timeline-view">
    <div class="detail-header">
      <button class="detail-back-btn" id="timeline-back-btn">
        <span class="material-symbols-outlined">arrow_back</span>
        Back
      </button>
      <h2 class="detail-title">Tab Story Timeline</h2>
    </div>

    <div class="timeline-filters">
      <button class="chip active" data-filter="all">All</button>
      <button class="chip" data-filter="today">Today</button>
      <button class="chip" data-filter="week">This Week</button>
    </div>

    <div class="timeline-content custom-scrollbar">
      <div class="timeline" id="timeline-container">
        <!-- Timeline items will be dynamically generated -->
      </div>
    </div>
  </div>

  <!-- ===== Intent Capture Modal ===== -->
  <div class="modal-backdrop" id="intent-modal-backdrop">
    <div class="modal animate-slide-up">
      <div class="modal-header">
        <h2 class="modal-title">What are you working on?</h2>
        <button class="modal-close" id="intent-modal-close" aria-label="Close">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 16px; color: var(--color-text-secondary);">
          <span class="material -symbols-outlined" style="vertical-align: middle; font-size: 18px;">edit</span>
          Enter your intent:
        </p>
        <input
          type="text"
          class="input-field"
          id="intent-input"
          placeholder='e.g., "Job Search", "Game Dev"'
          aria-label="Intent input"
        >

        <p style="margin-top: 24px; margin-bottom: 12px; font-weight: 500; color: var(--color-text-secondary);">
          Recent intents:
        </p>
        <div style="display: flex; flex-wrap: wrap; gap: 8px;" id="recent-intents">
          <!-- Recent intents will be dynamically populated -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-text" id="intent-skip-btn">Skip</button>
        <button class="btn btn-primary" id="intent-save-btn">
          <span class="material-symbols-outlined">save</span>
          Save Intent
        </button>
      </div>
    </div>
  </div>

  <!-- ===== Settings Modal ===== -->
  <div class="modal-backdrop" id="settings-modal-backdrop">
    <div class="modal animate-slide-up" style="width: 420px; max-width: 90%;">
      <div class="modal-header">
        <h2 class="modal-title">Settings</h2>
        <button class="modal-close" id="settings-modal-close" aria-label="Close">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="modal-body" style="max-height: 500px;">

        <!-- Appearance -->
        <div style="margin-bottom: 24px;">
          <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; font-size: 16px; font-weight: 500;">
            <span class="material-symbols-outlined">palette</span>
            Appearance
          </h3>
          <label class="toggle">
            <input type="checkbox" id="dark-mode">
            <span class="toggle-switch"></span>
            <span>Dark Mode</span>
          </label>
          <div style="height: 12px;"></div>
          <label class="toggle">
            <input type="checkbox" id="compact-view">
            <span class="toggle-switch"></span>
            <span>Compact View</span>
          </label>
        </div>

        <div class="divider"></div>

        <!-- Storage Usage -->
        <div style="margin-bottom: 24px;">
          <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; font-size: 16px; font-weight: 500;">
            <span class="material-symbols-outlined">monitoring</span>
            Storage Usage
          </h3>

          <!-- Storage Overview -->
          <div class="storage-overview" id="storage-overview">
            <div class="storage-stat-card">
              <div class="storage-stat-label">Total Used</div>
              <div class="storage-stat-value" id="storage-total">--</div>
              <div class="storage-stat-subtitle" id="storage-percentage">-- of 5 MB</div>
            </div>

            <div class="storage-stat-card">
              <div class="storage-stat-label">Tab Groups</div>
              <div class="storage-stat-value" id="storage-project-count">--</div>
              <div class="storage-stat-subtitle" id="storage-project-size">--</div>
            </div>

            <div class="storage-stat-card">
              <div class="storage-stat-label">Backups</div>
              <div class="storage-stat-value" id="storage-snapshot-count">--</div>
              <div class="storage-stat-subtitle" id="storage-snapshot-size">--</div>
            </div>
          </div>

          <!-- Storage Bar -->
          <div class="storage-bar-container" style="margin: 16px 0;">
            <div class="storage-bar">
              <div class="storage-bar-fill" id="storage-bar-fill" style="width: 0%;"></div>
            </div>
            <div class="storage-bar-legend">
              <span id="storage-status-text" style="font-size: 12px; color: var(--color-text-secondary);">Loading...</span>
            </div>
          </div>

          <!-- Storage Breakdown -->
          <div class="storage-breakdown" id="storage-breakdown">
            <div class="storage-breakdown-item">
              <div class="storage-breakdown-color" style="background: #2196F3;"></div>
              <div class="storage-breakdown-label">Tab Groups</div>
              <div class="storage-breakdown-value" id="breakdown-projects">--%</div>
            </div>
            <div class="storage-breakdown-item">
              <div class="storage-breakdown-color" style="background: #4CAF50;"></div>
              <div class="storage-breakdown-label">Backups</div>
              <div class="storage-breakdown-value" id="breakdown-snapshots">--%</div>
            </div>
            <div class="storage-breakdown-item">
              <div class="storage-breakdown-color" style="background: #FF9800;"></div>
              <div class="storage-breakdown-label">Other</div>
              <div class="storage-breakdown-value" id="breakdown-other">--%</div>
            </div>
          </div>

          <!-- Storage Actions -->
          <div class="storage-actions" style="margin-top: 16px; display: flex; gap: 8px; flex-wrap: wrap;">
            <button class="btn btn-text btn-sm" id="cleanup-snapshots-btn">
              <span class="material-symbols-outlined">cleaning_services</span>
              Clean Backups
            </button>
            <button class="btn btn-text btn-sm" id="cleanup-removed-tabs-btn">
              <span class="material-symbols-outlined">delete_sweep</span>
              Remove Deleted
            </button>
            <button class="btn btn-text btn-sm" id="refresh-storage-btn">
              <span class="material-symbols-outlined">refresh</span>
              Refresh
            </button>
          </div>

          <!-- Recommendations -->
          <div id="storage-recommendations" class="storage-recommendations" style="margin-top: 16px; display: none;">
            <!-- Recommendations will be dynamically added here -->
          </div>
        </div>

        <div class="divider"></div>

        <!-- Data Management -->
        <div style="margin-bottom: 24px;">
          <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; font-size: 16px; font-weight: 500;">
            <span class="material-symbols-outlined">storage</span>
            Data Management
          </h3>
          <button class="btn btn-outline" id="clear-data-btn">
            <span class="material-symbols-outlined">delete</span>
            Clear All Data
          </button>
        </div>

        <div class="divider"></div>

        <!-- About -->
        <div>
          <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; font-size: 16px; font-weight: 500;">
            <span class="material-symbols-outlined">info</span>
            About
          </h3>
          <p style="font-size: 14px; color: var(--color-text-secondary); margin-bottom: 12px;">
            Version: 1.0.0
          </p>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-text" id="report-bug-btn">
              <span class="material-symbols-outlined">bug_report</span>
              Report Bug
            </button>
            <button class="btn btn-text" id="github-star-btn">
              <span class="material-symbols-outlined">star</span>
              Star on GitHub
            </button>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="settings-close-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container"></div>

  <!-- Scripts -->
  <script src="../scripts/storage-manager.js"></script>
  <script src="../scripts/ai-manager.js"></script>
  <script src="../scripts/modal-manager.js"></script>
  <script src="../scripts/tab-manager.js"></script>
  <script src="../scripts/sidepanel.js"></script>

</body>
</html>
